<svg xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  version="1.1">
  <script xlink:href="/javascripts/annotations_svg.js" />
  <image x="0" y="16"
    width="200" height="150"
      style="z-index: 0;"
  xlink:href="<%= url_for(:action => 'download',
                          :controller => 'results',
              :select_file_id => @submission_file.id,
	      :show_in_browser => true) -%>" />

 
  <g id="shapes">
<% @annotations.each do |annotation| %>
  <g id="shape_<%= annotation.id%>">
<% if annotation.type == "ShapeAnnotation" %>
    <%
     paths = []
     currentPath = ""
     annotation.points.each do |point|
       # Split the shape in several paths, this is due to the fact that svg
       # uses the shape outlined by the path rather than the path itself to
       # detect mouseover events
       if currentPath == ""
         # First point of the shape
         currentPath = "M" + point.coord_x.to_s  + "," + point.coord_y.to_s
       elsif currentPath.split.length >= 9
         # Duplicate the last point of the path
         currentPath += " L" + point.coord_x.to_s  + "," + point.coord_y.to_s
         paths.push(currentPath)
         currentPath = "M" + point.coord_x.to_s  + "," + point.coord_y.to_s
       else
         # Normal point within a path
         currentPath += " L" + point.coord_x.to_s + "," + point.coord_y.to_s
       end
     end

     paths.push(currentPath)
    %>
    <% paths.each do |path| %>
      <path style="stroke: #FF0000; fill: none;" d="<%= path %>" />
    <% end %>
<% elsif annotation.type == "AreaAnnotation" %>
    <rect x="<%= annotation.x1%>" y="<%= annotation.y1%>"
      width="<%= (annotation.y2 - annotation.y1)%>"
      height="<%= (annotation.x2 - annotation.x1)%>" />
<% end %>
  </g>
<% end %>
  </g>
  <g id="annotations">
<% @annotations.each do |annotation| %>
  <g id="annotation_<%= annotation.id%>">
  <text><%= annotation.annotation_text.content %></text>
  </g>
<% end %>
</g>
 </g>

  <g id="toolbar" onmousemove ="return false;">	      
    <image x="0" y="0" 
      style="z-index: 0;"
      width="16" height="16"
      xlink:href = "/images/icons/pencil.png"
    />
    <image x="20" y="0" 
      width="16" height="16"
      xlink:href = "/images/icons/shape_square_add.png" 
      style="z-index: 0;"
    />
    <image x="40" y="0" z-index = "0"
      width="16" height="16"
      xlink:href = "/images/icons/comment_delete.png" 
      style="z-index: 0;"
    />
    <image x="60" y="0"
      width="16" height="16"
      style="z-index: 0;"
      xlink:href = "/images/icons/disk.png"
      />
  </g> 

 </svg>

